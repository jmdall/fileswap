{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/jmdall/PhpstormProjects/secure-file-exchange/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../../services/exchange.service\";\nimport * as i3 from \"../../services/websocket.service\";\nimport * as i4 from \"@angular/common\";\nfunction ExchangeComponent_span_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \\u23F1\\uFE0F \", ctx_r0.getTimeRemaining(), \" \");\n  }\n}\nfunction ExchangeComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.successMessage, \" \");\n  }\n}\nfunction ExchangeComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.statusMessage, \" \");\n  }\n}\nfunction ExchangeComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 23);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.errorMessage, \" \");\n  }\n}\nfunction ExchangeComponent_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 24);\n    i0.ɵɵelement(1, \"div\", 25);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExchangeComponent_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 26);\n    i0.ɵɵlistener(\"click\", function ExchangeComponent_div_19_Template_div_click_0_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const _r14 = i0.ɵɵreference(8);\n      return i0.ɵɵresetView(_r14.click());\n    })(\"dragover\", function ExchangeComponent_div_19_Template_div_dragover_0_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r17 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r17.onDragOver($event));\n    })(\"dragleave\", function ExchangeComponent_div_19_Template_div_dragleave_0_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r18 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r18.onDragLeave($event));\n    })(\"drop\", function ExchangeComponent_div_19_Template_div_drop_0_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r19 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r19.onDrop($event));\n    });\n    i0.ɵɵelementStart(1, \"div\", 27);\n    i0.ɵɵtext(2, \"\\u2B06\\uFE0F\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"Cliquez ou glissez votre fichier ici\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\", 28);\n    i0.ɵɵtext(6, \"Max 2 GB \\u2022 Tous formats accept\\u00E9s\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"input\", 29, 30);\n    i0.ɵɵlistener(\"change\", function ExchangeComponent_div_19_Template_input_change_7_listener($event) {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r20 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r20.onFileSelect($event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"dragging\", ctx_r5.isDragging);\n  }\n}\nfunction ExchangeComponent_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31)(1, \"div\", 32);\n    i0.ɵɵelement(2, \"div\", 33);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\", 34);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", ctx_r6.uploadProgress, \"%\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Upload: \", ctx_r6.uploadProgress, \"%\");\n  }\n}\nfunction ExchangeComponent_div_21_p_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 39);\n    i0.ɵɵtext(1, \" \\u2705 Vous avez accept\\u00E9 l'\\u00E9change \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExchangeComponent_div_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 35)(1, \"div\", 36);\n    i0.ɵɵtext(2, \"\\uD83D\\uDCC4\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 37)(4, \"h3\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\");\n    i0.ɵɵtext(9, \" Statut: \");\n    i0.ɵɵelementStart(10, \"span\");\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(12, ExchangeComponent_div_21_p_12_Template, 2, 0, \"p\", 38);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r7.myFile.filename);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Taille: \", ctx_r7.formatFileSize(ctx_r7.myFile.size), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵclassMap(ctx_r7.getStatusClass(ctx_r7.myFile.status));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r7.getStatusText(ctx_r7.myFile.status), \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r7.iAccepted);\n  }\n}\nfunction ExchangeComponent_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 40)(1, \"div\", 41);\n    i0.ɵɵtext(2, \"\\u23F3\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"En attente du fichier...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ExchangeComponent_div_27_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 44)(1, \"p\");\n    i0.ɵɵtext(2, \"SHA-256:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"code\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r22 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r22.peerFile.sha256 == null ? null : ctx_r22.peerFile.sha256.substring(0, 32), \"...\");\n  }\n}\nfunction ExchangeComponent_div_27_p_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 39);\n    i0.ɵɵtext(1, \" \\u2705 L'autre participant a accept\\u00E9 \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExchangeComponent_div_27_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r26 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 45)(1, \"p\", 46);\n    i0.ɵɵtext(2, \"Aper\\u00E7u :\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"img\", 47);\n    i0.ɵɵlistener(\"error\", function ExchangeComponent_div_27_div_16_Template_img_error_3_listener($event) {\n      i0.ɵɵrestoreView(_r26);\n      const ctx_r25 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r25.onPreviewError($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\", 48);\n    i0.ɵɵtext(5, \"Aper\\u00E7u limit\\u00E9 - Le fichier complet sera disponible apr\\u00E8s validation\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r24 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"src\", ctx_r24.getPreviewUrl(ctx_r24.peerFile.previewUrl), i0.ɵɵsanitizeUrl);\n  }\n}\nfunction ExchangeComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 35)(1, \"div\", 36);\n    i0.ɵɵtext(2, \"\\uD83D\\uDCC4\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 37)(4, \"h3\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"p\");\n    i0.ɵɵtext(11, \" Statut: \");\n    i0.ɵɵelementStart(12, \"span\");\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(14, ExchangeComponent_div_27_div_14_Template, 5, 1, \"div\", 42);\n    i0.ɵɵtemplate(15, ExchangeComponent_div_27_p_15_Template, 2, 0, \"p\", 38);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(16, ExchangeComponent_div_27_div_16_Template, 6, 1, \"div\", 43);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(ctx_r9.peerFile.filename);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Taille: \", ctx_r9.formatFileSize(ctx_r9.peerFile.size), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Type: \", ctx_r9.peerFile.mimeType, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵclassMap(ctx_r9.getStatusClass(ctx_r9.peerFile.status));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r9.getStatusText(ctx_r9.peerFile.status), \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.peerFile.sha256);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.peerAccepted);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r9.peerFile.previewUrl && ctx_r9.peerFile.status === \"ready\");\n  }\n}\nfunction ExchangeComponent_div_28_span_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"\\u2705 Accepter l'\\u00E9change\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExchangeComponent_div_28_span_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"\\u2713 Accept\\u00E9\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ExchangeComponent_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r30 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 49)(1, \"div\", 12)(2, \"h2\");\n    i0.ɵɵtext(3, \"Validation de l'\\u00E9change\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5, \"Les deux fichiers sont pr\\u00EAts. V\\u00E9rifiez les informations ci-dessus avant d'accepter.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 50)(7, \"button\", 51);\n    i0.ɵɵlistener(\"click\", function ExchangeComponent_div_28_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r30);\n      const ctx_r29 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r29.acceptExchange());\n    });\n    i0.ɵɵtemplate(8, ExchangeComponent_div_28_span_8_Template, 2, 0, \"span\", 52);\n    i0.ɵɵtemplate(9, ExchangeComponent_div_28_span_9_Template, 2, 0, \"span\", 52);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"button\", 53);\n    i0.ɵɵlistener(\"click\", function ExchangeComponent_div_28_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r30);\n      const ctx_r31 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r31.rejectExchange());\n    });\n    i0.ɵɵtext(11, \" \\u274C Refuser l'\\u00E9change \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"div\", 54)(13, \"div\", 55)(14, \"span\", 56);\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"span\");\n    i0.ɵɵtext(17, \"Votre validation\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"div\", 55)(19, \"span\", 56);\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"span\");\n    i0.ɵɵtext(22, \"Validation de l'autre participant\");\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"disabled\", !ctx_r10.canAccept() || ctx_r10.iAccepted || ctx_r10.isLoading);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r10.iAccepted);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r10.iAccepted);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r10.iAccepted || ctx_r10.isLoading);\n    i0.ɵɵadvance(3);\n    i0.ɵɵclassProp(\"validated\", ctx_r10.iAccepted);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r10.iAccepted ? \"\\u2705\" : \"\\u2B55\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵclassProp(\"validated\", ctx_r10.peerAccepted);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r10.peerAccepted ? \"\\u2705\" : \"\\u2B55\");\n  }\n}\nfunction ExchangeComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r33 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 57)(1, \"div\", 58)(2, \"h2\");\n    i0.ɵɵtext(3, \"\\uD83C\\uDF89 \\u00C9change valid\\u00E9 avec succ\\u00E8s !\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5, \"Les deux parties ont accept\\u00E9 l'\\u00E9change. Vous pouvez maintenant t\\u00E9l\\u00E9charger les fichiers.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 59)(7, \"button\", 60);\n    i0.ɵɵlistener(\"click\", function ExchangeComponent_div_29_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r33);\n      const ctx_r32 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r32.downloadFile(\"mine\"));\n    });\n    i0.ɵɵtext(8, \" \\u2B07\\uFE0F T\\u00E9l\\u00E9charger mon fichier \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"button\", 60);\n    i0.ɵɵlistener(\"click\", function ExchangeComponent_div_29_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r33);\n      const ctx_r34 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r34.downloadFile(\"peer\"));\n    });\n    i0.ɵɵtext(10, \" \\u2B07\\uFE0F T\\u00E9l\\u00E9charger le fichier re\\u00E7u \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"p\", 61);\n    i0.ɵɵtext(12, \" \\u26A0\\uFE0F Les liens de t\\u00E9l\\u00E9chargement expirent dans 10 minutes \");\n    i0.ɵɵelementEnd()()();\n  }\n}\nfunction ExchangeComponent_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 62)(1, \"h2\");\n    i0.ɵɵtext(2, \"\\u274C \\u00C9change annul\\u00E9\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"L'\\u00E9change a \\u00E9t\\u00E9 annul\\u00E9. Les fichiers ont \\u00E9t\\u00E9 supprim\\u00E9s.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ExchangeComponent_div_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 62)(1, \"h2\");\n    i0.ɵɵtext(2, \"\\u23F1\\uFE0F Session expir\\u00E9e\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"La session a expir\\u00E9. Les fichiers ont \\u00E9t\\u00E9 supprim\\u00E9s.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport class ExchangeComponent {\n  constructor(route, exchangeService, wsService) {\n    this.route = route;\n    this.exchangeService = exchangeService;\n    this.wsService = wsService;\n    // Session info\n    this.sessionId = '';\n    this.token = '';\n    this.jwtToken = '';\n    this.role = 'A';\n    this.sessionState = 'created';\n    this.expiresAt = null;\n    // Files\n    this.myFile = null;\n    this.peerFile = null;\n    this.selectedFile = null;\n    this.uploadProgress = 0;\n    this.isUploading = false;\n    // Acceptance states\n    this.iAccepted = false;\n    this.peerAccepted = false;\n    // Download URLs\n    this.downloadUrls = null;\n    // Subscriptions\n    this.subscriptions = [];\n    // Messages\n    this.statusMessage = '';\n    this.errorMessage = '';\n    this.successMessage = '';\n    // UI states\n    this.isLoading = false;\n    this.isDragging = false;\n  }\n  ngOnInit() {\n    // Get parameters from URL\n    this.route.queryParams.subscribe(params => {\n      this.sessionId = params['sid'];\n      this.token = params['token'];\n      if (this.sessionId && this.token) {\n        this.joinSession();\n      } else {\n        this.errorMessage = 'Paramètres de session manquants';\n      }\n    });\n    // Listen to WebSocket messages\n    this.subscriptions.push(this.wsService.messages$.subscribe(message => {\n      this.handleWebSocketMessage(message);\n    }));\n  }\n  ngOnDestroy() {\n    this.subscriptions.forEach(sub => sub.unsubscribe());\n    this.wsService.disconnect();\n  }\n  joinSession() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this.isLoading = true;\n      _this.errorMessage = '';\n      try {\n        const response = yield _this.exchangeService.joinSession(_this.sessionId, _this.token);\n        // Store JWT token\n        _this.jwtToken = response.token;\n        localStorage.setItem('exchangeToken', response.token);\n        _this.role = response.role;\n        _this.sessionState = response.state;\n        _this.expiresAt = new Date(response.expiresAt);\n        // Connect to WebSocket\n        _this.wsService.connect(response.token);\n        // Get initial status\n        yield _this.refreshStatus();\n        _this.successMessage = `Connecté en tant que participant ${_this.role}`;\n      } catch (error) {\n        _this.errorMessage = error.error?.message || 'Erreur lors de la connexion';\n      } finally {\n        _this.isLoading = false;\n      }\n    })();\n  }\n  refreshStatus() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const status = yield _this2.exchangeService.getSessionStatus(_this2.sessionId);\n        _this2.sessionState = status.session.state;\n        _this2.myFile = status.me.file;\n        _this2.peerFile = status.peer.file;\n        _this2.iAccepted = status.me.accepted;\n        _this2.peerAccepted = status.peer.accepted;\n      } catch (error) {\n        console.error('Error refreshing status:', error);\n      }\n    })();\n  }\n  onFileSelect(event) {\n    const file = event.target.files[0];\n    if (file) {\n      this.handleFile(file);\n    }\n  }\n  onDragOver(event) {\n    event.preventDefault();\n    this.isDragging = true;\n  }\n  onDragLeave(event) {\n    event.preventDefault();\n    this.isDragging = false;\n  }\n  onDrop(event) {\n    event.preventDefault();\n    this.isDragging = false;\n    const files = event.dataTransfer?.files;\n    if (files && files.length > 0) {\n      this.handleFile(files[0]);\n    }\n  }\n  handleFile(file) {\n    // Check file size\n    const maxSize = 2 * 1024 * 1024 * 1024; // 2GB\n    if (file.size > maxSize) {\n      this.errorMessage = 'Fichier trop volumineux (max 2GB)';\n      return;\n    }\n    this.selectedFile = file;\n    this.uploadFile();\n  }\n  uploadFile() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this3.selectedFile) return;\n      _this3.isUploading = true;\n      _this3.uploadProgress = 0;\n      _this3.errorMessage = '';\n      try {\n        // Get presigned URL\n        const presignResponse = yield _this3.exchangeService.getPresignedUrl(_this3.selectedFile.name, _this3.selectedFile.size, _this3.selectedFile.type || 'application/octet-stream');\n        // Upload to S3\n        yield _this3.uploadToS3(_this3.selectedFile, presignResponse.uploadUrl);\n        // Confirm upload completion\n        yield _this3.exchangeService.completeUpload(presignResponse.fileId, presignResponse.storageKey);\n        _this3.myFile = {\n          id: presignResponse.fileId,\n          filename: _this3.selectedFile.name,\n          size: _this3.selectedFile.size,\n          status: 'processing'\n        };\n        _this3.statusMessage = 'Fichier en cours de traitement...';\n        _this3.selectedFile = null;\n      } catch (error) {\n        _this3.errorMessage = error.error?.message || 'Erreur lors de l\\'upload';\n      } finally {\n        _this3.isUploading = false;\n        _this3.uploadProgress = 0;\n      }\n    })();\n  }\n  uploadToS3(file, presignedUrl) {\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener('progress', e => {\n        if (e.lengthComputable) {\n          this.uploadProgress = Math.round(e.loaded / e.total * 100);\n        }\n      });\n      xhr.addEventListener('load', () => {\n        if (xhr.status >= 200 && xhr.status < 300) {\n          resolve();\n        } else {\n          reject(new Error(`Upload failed: ${xhr.status}`));\n        }\n      });\n      xhr.addEventListener('error', () => {\n        reject(new Error('Upload failed'));\n      });\n      xhr.open('PUT', presignedUrl);\n      xhr.setRequestHeader('Content-Type', file.type || 'application/octet-stream');\n      xhr.send(file);\n    });\n  }\n  acceptExchange() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this4.canAccept()) return;\n      _this4.isLoading = true;\n      _this4.errorMessage = '';\n      try {\n        const response = yield _this4.exchangeService.acceptExchange(_this4.sessionId);\n        _this4.iAccepted = true;\n        if (response.state === 'released') {\n          _this4.sessionState = 'released';\n          _this4.downloadUrls = response.downloadUrls;\n          _this4.successMessage = 'Échange validé ! Les fichiers sont disponibles.';\n        } else {\n          _this4.statusMessage = 'En attente de l\\'acceptation de l\\'autre participant...';\n        }\n      } catch (error) {\n        _this4.errorMessage = error.error?.message || 'Erreur lors de l\\'acceptation';\n      } finally {\n        _this4.isLoading = false;\n      }\n    })();\n  }\n  rejectExchange() {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      if (confirm('Êtes-vous sûr de vouloir annuler cet échange ?')) {\n        _this5.isLoading = true;\n        try {\n          yield _this5.exchangeService.rejectExchange(_this5.sessionId);\n          _this5.sessionState = 'cancelled';\n          _this5.statusMessage = 'Échange annulé';\n        } catch (error) {\n          _this5.errorMessage = error.error?.message || 'Erreur lors de l\\'annulation';\n        } finally {\n          _this5.isLoading = false;\n        }\n      }\n    })();\n  }\n  canAccept() {\n    return this.sessionState === 'ready' && !this.iAccepted && this.myFile?.status === 'ready' && this.peerFile?.status === 'ready';\n  }\n  downloadFile(type) {\n    if (!this.downloadUrls) return;\n    const url = type === 'mine' ? this.downloadUrls[this.role] : this.downloadUrls[this.role === 'A' ? 'B' : 'A'];\n    // Add base URL if needed\n    const fullUrl = url.startsWith('http') ? url : `http://localhost:3000${url}`;\n    window.open(fullUrl, '_blank');\n  }\n  handleWebSocketMessage(message) {\n    switch (message.type) {\n      case 'connected':\n        console.log('WebSocket connected');\n        break;\n      case 'file_ready':\n        this.refreshStatus();\n        this.statusMessage = 'Un fichier est prêt';\n        break;\n      case 'session_ready':\n        this.sessionState = 'ready';\n        this.successMessage = 'Les deux fichiers sont prêts. Vous pouvez maintenant accepter l\\'échange.';\n        this.refreshStatus();\n        break;\n      case 'peer_accepted':\n        this.peerAccepted = true;\n        this.statusMessage = 'L\\'autre participant a accepté l\\'échange';\n        break;\n      case 'released':\n        this.sessionState = 'released';\n        this.downloadUrls = message.downloadUrls;\n        this.successMessage = 'Échange validé ! Les fichiers sont disponibles.';\n        break;\n      case 'cancelled':\n        this.sessionState = 'cancelled';\n        this.statusMessage = 'L\\'échange a été annulé';\n        break;\n      case 'file_blocked':\n        this.errorMessage = `Fichier bloqué : ${message.reason}`;\n        break;\n      case 'error':\n        this.errorMessage = message.message;\n        break;\n    }\n  }\n  formatFileSize(bytes) {\n    if (!bytes) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n  }\n  getTimeRemaining() {\n    if (!this.expiresAt) return '';\n    const now = new Date().getTime();\n    const expires = this.expiresAt.getTime();\n    const diff = expires - now;\n    if (diff <= 0) return 'Expiré';\n    const hours = Math.floor(diff / (1000 * 60 * 60));\n    const minutes = Math.floor(diff % (1000 * 60 * 60) / (1000 * 60));\n    return `${hours}h ${minutes}min`;\n  }\n  getStatusClass(status) {\n    switch (status) {\n      case 'ready':\n        return 'status-ready';\n      case 'processing':\n        return 'status-processing';\n      case 'uploading':\n        return 'status-uploading';\n      case 'scanning':\n        return 'status-scanning';\n      case 'blocked':\n        return 'status-blocked';\n      default:\n        return '';\n    }\n  }\n  getStatusText(status) {\n    switch (status) {\n      case 'ready':\n        return 'Prêt';\n      case 'processing':\n        return 'Traitement...';\n      case 'uploading':\n        return 'Upload...';\n      case 'scanning':\n        return 'Scan antivirus...';\n      case 'blocked':\n        return 'Bloqué';\n      default:\n        return status;\n    }\n  }\n  getPreviewUrl(url) {\n    // Construire l'URL complète pour la preview\n    if (url.startsWith('http')) {\n      return url;\n    }\n    return `http://localhost:3000${url}`;\n  }\n  onPreviewError(event) {\n    console.log('Preview failed to load');\n    // Masquer l'image en erreur\n    event.target.style.display = 'none';\n  }\n  static {\n    this.ɵfac = function ExchangeComponent_Factory(t) {\n      return new (t || ExchangeComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.ExchangeService), i0.ɵɵdirectiveInject(i3.WebSocketService));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ExchangeComponent,\n      selectors: [[\"app-exchange\"]],\n      decls: 32,\n      vars: 22,\n      consts: [[1, \"container\"], [1, \"session-header\"], [1, \"session-meta\"], [1, \"role-badge\"], [1, \"state-badge\"], [\"class\", \"timer\", 4, \"ngIf\"], [\"class\", \"alert alert-success\", 4, \"ngIf\"], [\"class\", \"alert alert-info\", 4, \"ngIf\"], [\"class\", \"alert alert-danger\", 4, \"ngIf\"], [\"class\", \"loading-overlay\", 4, \"ngIf\"], [1, \"exchange-grid\"], [1, \"file-section\"], [1, \"card\"], [\"class\", \"file-upload\", 3, \"dragging\", \"click\", \"dragover\", \"dragleave\", \"drop\", 4, \"ngIf\"], [\"class\", \"upload-progress\", 4, \"ngIf\"], [\"class\", \"file-info\", 4, \"ngIf\"], [\"class\", \"waiting-peer\", 4, \"ngIf\"], [\"class\", \"action-section\", 4, \"ngIf\"], [\"class\", \"download-section\", 4, \"ngIf\"], [\"class\", \"card error-card\", 4, \"ngIf\"], [1, \"timer\"], [1, \"alert\", \"alert-success\"], [1, \"alert\", \"alert-info\"], [1, \"alert\", \"alert-danger\"], [1, \"loading-overlay\"], [1, \"spinner\"], [1, \"file-upload\", 3, \"click\", \"dragover\", \"dragleave\", \"drop\"], [1, \"upload-icon\"], [1, \"upload-hint\"], [\"type\", \"file\", 2, \"display\", \"none\", 3, \"change\"], [\"fileInput\", \"\"], [1, \"upload-progress\"], [1, \"progress-bar\"], [1, \"progress-fill\"], [1, \"text-center\"], [1, \"file-info\"], [1, \"file-icon\"], [1, \"file-details\"], [\"class\", \"accepted-badge\", 4, \"ngIf\"], [1, \"accepted-badge\"], [1, \"waiting-peer\"], [1, \"waiting-icon\"], [\"class\", \"hash-info\", 4, \"ngIf\"], [\"class\", \"file-preview\", 4, \"ngIf\"], [1, \"hash-info\"], [1, \"file-preview\"], [1, \"preview-label\"], [\"alt\", \"Aper\\u00E7u du fichier\", 3, \"src\", \"error\"], [1, \"preview-note\"], [1, \"action-section\"], [1, \"action-buttons\"], [1, \"btn\", \"btn-primary\", \"btn-large\", 3, \"disabled\", \"click\"], [4, \"ngIf\"], [1, \"btn\", \"btn-danger\", 3, \"disabled\", \"click\"], [1, \"validation-status\"], [1, \"validation-item\"], [1, \"validation-icon\"], [1, \"download-section\"], [1, \"card\", \"success-card\"], [1, \"download-buttons\"], [1, \"btn\", \"btn-success\", \"btn-large\", 3, \"click\"], [1, \"download-warning\"], [1, \"card\", \"error-card\"]],\n      template: function ExchangeComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\");\n          i0.ɵɵtext(3, \"\\uD83D\\uDD12 Session d'\\u00E9change\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"div\", 2)(5, \"span\", 3);\n          i0.ɵɵtext(6);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"span\", 4);\n          i0.ɵɵtext(8);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(9, ExchangeComponent_span_9_Template, 2, 1, \"span\", 5);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(10, ExchangeComponent_div_10_Template, 2, 1, \"div\", 6);\n          i0.ɵɵtemplate(11, ExchangeComponent_div_11_Template, 2, 1, \"div\", 7);\n          i0.ɵɵtemplate(12, ExchangeComponent_div_12_Template, 2, 1, \"div\", 8);\n          i0.ɵɵtemplate(13, ExchangeComponent_div_13_Template, 2, 0, \"div\", 9);\n          i0.ɵɵelementStart(14, \"div\", 10)(15, \"div\", 11)(16, \"div\", 12)(17, \"h2\");\n          i0.ɵɵtext(18, \"\\uD83D\\uDCC1 Mon fichier\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(19, ExchangeComponent_div_19_Template, 9, 2, \"div\", 13);\n          i0.ɵɵtemplate(20, ExchangeComponent_div_20_Template, 5, 3, \"div\", 14);\n          i0.ɵɵtemplate(21, ExchangeComponent_div_21_Template, 13, 6, \"div\", 15);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(22, \"div\", 11)(23, \"div\", 12)(24, \"h2\");\n          i0.ɵɵtext(25, \"\\uD83D\\uDD0D Fichier de l'autre participant\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(26, ExchangeComponent_div_26_Template, 5, 0, \"div\", 16);\n          i0.ɵɵtemplate(27, ExchangeComponent_div_27_Template, 17, 9, \"div\", 15);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵtemplate(28, ExchangeComponent_div_28_Template, 23, 10, \"div\", 17);\n          i0.ɵɵtemplate(29, ExchangeComponent_div_29_Template, 13, 0, \"div\", 18);\n          i0.ɵɵtemplate(30, ExchangeComponent_div_30_Template, 5, 0, \"div\", 19);\n          i0.ɵɵtemplate(31, ExchangeComponent_div_31_Template, 5, 0, \"div\", 19);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(5);\n          i0.ɵɵclassProp(\"role-a\", ctx.role === \"A\")(\"role-b\", ctx.role === \"B\");\n          i0.ɵɵadvance(1);\n          i0.ɵɵtextInterpolate1(\" Participant \", ctx.role, \" \");\n          i0.ɵɵadvance(1);\n          i0.ɵɵclassMap(\"state-\" + ctx.sessionState);\n          i0.ɵɵadvance(1);\n          i0.ɵɵtextInterpolate1(\" \", ctx.sessionState, \" \");\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.expiresAt);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.successMessage);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.statusMessage);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.isLoading);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngIf\", !ctx.myFile);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.isUploading);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.myFile);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngIf\", !ctx.peerFile);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.peerFile);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.sessionState === \"ready\");\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.sessionState === \"released\" && ctx.downloadUrls);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.sessionState === \"cancelled\");\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.sessionState === \"expired\");\n        }\n      },\n      dependencies: [i4.NgIf],\n      styles: [\".session-header[_ngcontent-%COMP%] {\\n  background: white;\\n  border-radius: 12px;\\n  padding: 2rem;\\n  margin-bottom: 2rem;\\n  box-shadow: 0 4px 20px rgba(0,0,0,0.08);\\n}\\n\\n.session-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%] {\\n  margin: 0 0 1rem 0;\\n  color: #333;\\n}\\n\\n.session-meta[_ngcontent-%COMP%] {\\n  display: flex;\\n  gap: 1rem;\\n  align-items: center;\\n  flex-wrap: wrap;\\n}\\n\\n.role-badge[_ngcontent-%COMP%] {\\n  padding: 0.5rem 1rem;\\n  border-radius: 20px;\\n  font-weight: 500;\\n  color: white;\\n}\\n\\n.role-a[_ngcontent-%COMP%] {\\n  background: #007bff;\\n}\\n\\n.role-b[_ngcontent-%COMP%] {\\n  background: #28a745;\\n}\\n\\n.state-badge[_ngcontent-%COMP%] {\\n  padding: 0.5rem 1rem;\\n  border-radius: 20px;\\n  font-weight: 500;\\n  background: #f8f9fa;\\n  color: #666;\\n}\\n\\n.state-created[_ngcontent-%COMP%] { background: #f8f9fa; color: #666; }\\n.state-ready[_ngcontent-%COMP%] { background: #fff3cd; color: #856404; }\\n.state-accepted[_ngcontent-%COMP%] { background: #d1ecf1; color: #0c5460; }\\n.state-released[_ngcontent-%COMP%] { background: #d4edda; color: #155724; }\\n.state-cancelled[_ngcontent-%COMP%] { background: #f8d7da; color: #721c24; }\\n.state-expired[_ngcontent-%COMP%] { background: #e0e0e0; color: #666; }\\n\\n.timer[_ngcontent-%COMP%] {\\n  padding: 0.5rem 1rem;\\n  background: #f0f8ff;\\n  border-radius: 20px;\\n  color: #0066cc;\\n  font-weight: 500;\\n}\\n\\n.exchange-grid[_ngcontent-%COMP%] {\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n  gap: 2rem;\\n  margin-bottom: 2rem;\\n}\\n\\n@media (max-width: 768px) {\\n  .exchange-grid[_ngcontent-%COMP%] {\\n    grid-template-columns: 1fr;\\n  }\\n}\\n\\n.file-section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%] {\\n  height: 100%;\\n  min-height: 400px;\\n}\\n\\n.file-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%] {\\n  color: #333;\\n  margin-bottom: 1.5rem;\\n  padding-bottom: 1rem;\\n  border-bottom: 2px solid #f0f0f0;\\n}\\n\\n.waiting-peer[_ngcontent-%COMP%] {\\n  text-align: center;\\n  padding: 3rem;\\n  color: #999;\\n}\\n\\n.waiting-icon[_ngcontent-%COMP%] {\\n  font-size: 3rem;\\n  margin-bottom: 1rem;\\n  animation: _ngcontent-%COMP%_pulse 2s infinite;\\n}\\n\\n@keyframes _ngcontent-%COMP%_pulse {\\n  0%, 100% { opacity: 1; }\\n  50% { opacity: 0.5; }\\n}\\n\\n.upload-progress[_ngcontent-%COMP%] {\\n  padding: 1rem;\\n}\\n\\n.file-info[_ngcontent-%COMP%] {\\n  padding: 1rem;\\n  background: #f8f9fa;\\n  border-radius: 8px;\\n}\\n\\n.file-icon[_ngcontent-%COMP%] {\\n  font-size: 3rem;\\n  text-align: center;\\n  margin-bottom: 1rem;\\n}\\n\\n.file-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%] {\\n  color: #333;\\n  margin-bottom: 0.5rem;\\n  word-break: break-all;\\n}\\n\\n.file-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\\n  color: #666;\\n  margin-bottom: 0.5rem;\\n}\\n\\n.hash-info[_ngcontent-%COMP%] {\\n  margin-top: 1rem;\\n  padding: 0.5rem;\\n  background: white;\\n  border-radius: 4px;\\n}\\n\\n.hash-info[_ngcontent-%COMP%]   code[_ngcontent-%COMP%] {\\n  font-family: 'Courier New', monospace;\\n  font-size: 0.8rem;\\n  color: #666;\\n  word-break: break-all;\\n}\\n\\n.file-preview[_ngcontent-%COMP%] {\\n  margin-top: 1rem;\\n  text-align: center;\\n}\\n\\n.file-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%] {\\n  max-width: 100%;\\n  max-height: 200px;\\n  border-radius: 8px;\\n  box-shadow: 0 2px 10px rgba(0,0,0,0.1);\\n}\\n\\n.accepted-badge[_ngcontent-%COMP%] {\\n  color: #28a745;\\n  font-weight: 500;\\n  margin-top: 0.5rem;\\n}\\n\\n.status-ready[_ngcontent-%COMP%] { color: #28a745; }\\n.status-processing[_ngcontent-%COMP%] { color: #ffc107; }\\n.status-uploading[_ngcontent-%COMP%] { color: #17a2b8; }\\n.status-scanning[_ngcontent-%COMP%] { color: #6c757d; }\\n.status-blocked[_ngcontent-%COMP%] { color: #dc3545; }\\n\\n.action-section[_ngcontent-%COMP%] {\\n  margin: 2rem 0;\\n}\\n\\n.action-section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%] {\\n  text-align: center;\\n  padding: 2rem;\\n}\\n\\n.action-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%] {\\n  color: #333;\\n  margin-bottom: 1rem;\\n}\\n\\n.action-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%] {\\n  color: #666;\\n  margin-bottom: 2rem;\\n}\\n\\n.action-buttons[_ngcontent-%COMP%] {\\n  display: flex;\\n  gap: 1rem;\\n  justify-content: center;\\n  margin-bottom: 2rem;\\n}\\n\\n.btn-large[_ngcontent-%COMP%] {\\n  padding: 1rem 2rem;\\n  font-size: 1.1rem;\\n}\\n\\n.validation-status[_ngcontent-%COMP%] {\\n  display: flex;\\n  justify-content: center;\\n  gap: 3rem;\\n  padding: 1.5rem;\\n  background: #f8f9fa;\\n  border-radius: 8px;\\n}\\n\\n.validation-item[_ngcontent-%COMP%] {\\n  display: flex;\\n  align-items: center;\\n  gap: 0.5rem;\\n  color: #666;\\n  font-weight: 500;\\n}\\n\\n.validation-item.validated[_ngcontent-%COMP%] {\\n  color: #28a745;\\n}\\n\\n.validation-icon[_ngcontent-%COMP%] {\\n  font-size: 1.5rem;\\n}\\n\\n.download-section[_ngcontent-%COMP%] {\\n  margin: 2rem 0;\\n}\\n\\n.success-card[_ngcontent-%COMP%] {\\n  background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);\\n  border: 2px solid #b1dfbb;\\n  text-align: center;\\n  padding: 2rem;\\n}\\n\\n.success-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%] {\\n  color: #155724;\\n  margin-bottom: 1rem;\\n}\\n\\n.download-buttons[_ngcontent-%COMP%] {\\n  display: flex;\\n  gap: 1rem;\\n  justify-content: center;\\n  margin: 2rem 0;\\n}\\n\\n.download-warning[_ngcontent-%COMP%] {\\n  color: #856404;\\n  background: #fff3cd;\\n  padding: 0.5rem 1rem;\\n  border-radius: 4px;\\n  display: inline-block;\\n  margin-top: 1rem;\\n}\\n\\n.error-card[_ngcontent-%COMP%] {\\n  background: #f8d7da;\\n  border: 2px solid #f5c6cb;\\n  text-align: center;\\n  padding: 2rem;\\n}\\n\\n.error-card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%] {\\n  color: #721c24;\\n  margin-bottom: 1rem;\\n}\\n\\n.loading-overlay[_ngcontent-%COMP%] {\\n  position: fixed;\\n  top: 0;\\n  left: 0;\\n  right: 0;\\n  bottom: 0;\\n  background: rgba(0,0,0,0.5);\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  z-index: 9999;\\n}\\n\\n.preview-label[_ngcontent-%COMP%] {\\n  font-weight: 500;\\n  color: #666;\\n  margin-bottom: 0.5rem;\\n}\\n\\n.preview-note[_ngcontent-%COMP%] {\\n  font-size: 0.85rem;\\n  color: #999;\\n  font-style: italic;\\n  margin-top: 0.5rem;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9leGNoYW5nZS9leGNoYW5nZS5jb21wb25lbnQuY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0UsaUJBQWlCO0VBQ2pCLG1CQUFtQjtFQUNuQixhQUFhO0VBQ2IsbUJBQW1CO0VBQ25CLHVDQUF1QztBQUN6Qzs7QUFFQTtFQUNFLGtCQUFrQjtFQUNsQixXQUFXO0FBQ2I7O0FBRUE7RUFDRSxhQUFhO0VBQ2IsU0FBUztFQUNULG1CQUFtQjtFQUNuQixlQUFlO0FBQ2pCOztBQUVBO0VBQ0Usb0JBQW9CO0VBQ3BCLG1CQUFtQjtFQUNuQixnQkFBZ0I7RUFDaEIsWUFBWTtBQUNkOztBQUVBO0VBQ0UsbUJBQW1CO0FBQ3JCOztBQUVBO0VBQ0UsbUJBQW1CO0FBQ3JCOztBQUVBO0VBQ0Usb0JBQW9CO0VBQ3BCLG1CQUFtQjtFQUNuQixnQkFBZ0I7RUFDaEIsbUJBQW1CO0VBQ25CLFdBQVc7QUFDYjs7QUFFQSxpQkFBaUIsbUJBQW1CLEVBQUUsV0FBVyxFQUFFO0FBQ25ELGVBQWUsbUJBQW1CLEVBQUUsY0FBYyxFQUFFO0FBQ3BELGtCQUFrQixtQkFBbUIsRUFBRSxjQUFjLEVBQUU7QUFDdkQsa0JBQWtCLG1CQUFtQixFQUFFLGNBQWMsRUFBRTtBQUN2RCxtQkFBbUIsbUJBQW1CLEVBQUUsY0FBYyxFQUFFO0FBQ3hELGlCQUFpQixtQkFBbUIsRUFBRSxXQUFXLEVBQUU7O0FBRW5EO0VBQ0Usb0JBQW9CO0VBQ3BCLG1CQUFtQjtFQUNuQixtQkFBbUI7RUFDbkIsY0FBYztFQUNkLGdCQUFnQjtBQUNsQjs7QUFFQTtFQUNFLGFBQWE7RUFDYiw4QkFBOEI7RUFDOUIsU0FBUztFQUNULG1CQUFtQjtBQUNyQjs7QUFFQTtFQUNFO0lBQ0UsMEJBQTBCO0VBQzVCO0FBQ0Y7O0FBRUE7RUFDRSxZQUFZO0VBQ1osaUJBQWlCO0FBQ25COztBQUVBO0VBQ0UsV0FBVztFQUNYLHFCQUFxQjtFQUNyQixvQkFBb0I7RUFDcEIsZ0NBQWdDO0FBQ2xDOztBQUVBO0VBQ0Usa0JBQWtCO0VBQ2xCLGFBQWE7RUFDYixXQUFXO0FBQ2I7O0FBRUE7RUFDRSxlQUFlO0VBQ2YsbUJBQW1CO0VBQ25CLDRCQUE0QjtBQUM5Qjs7QUFFQTtFQUNFLFdBQVcsVUFBVSxFQUFFO0VBQ3ZCLE1BQU0sWUFBWSxFQUFFO0FBQ3RCOztBQUVBO0VBQ0UsYUFBYTtBQUNmOztBQUVBO0VBQ0UsYUFBYTtFQUNiLG1CQUFtQjtFQUNuQixrQkFBa0I7QUFDcEI7O0FBRUE7RUFDRSxlQUFlO0VBQ2Ysa0JBQWtCO0VBQ2xCLG1CQUFtQjtBQUNyQjs7QUFFQTtFQUNFLFdBQVc7RUFDWCxxQkFBcUI7RUFDckIscUJBQXFCO0FBQ3ZCOztBQUVBO0VBQ0UsV0FBVztFQUNYLHFCQUFxQjtBQUN2Qjs7QUFFQTtFQUNFLGdCQUFnQjtFQUNoQixlQUFlO0VBQ2YsaUJBQWlCO0VBQ2pCLGtCQUFrQjtBQUNwQjs7QUFFQTtFQUNFLHFDQUFxQztFQUNyQyxpQkFBaUI7RUFDakIsV0FBVztFQUNYLHFCQUFxQjtBQUN2Qjs7QUFFQTtFQUNFLGdCQUFnQjtFQUNoQixrQkFBa0I7QUFDcEI7O0FBRUE7RUFDRSxlQUFlO0VBQ2YsaUJBQWlCO0VBQ2pCLGtCQUFrQjtFQUNsQixzQ0FBc0M7QUFDeEM7O0FBRUE7RUFDRSxjQUFjO0VBQ2QsZ0JBQWdCO0VBQ2hCLGtCQUFrQjtBQUNwQjs7QUFFQSxnQkFBZ0IsY0FBYyxFQUFFO0FBQ2hDLHFCQUFxQixjQUFjLEVBQUU7QUFDckMsb0JBQW9CLGNBQWMsRUFBRTtBQUNwQyxtQkFBbUIsY0FBYyxFQUFFO0FBQ25DLGtCQUFrQixjQUFjLEVBQUU7O0FBRWxDO0VBQ0UsY0FBYztBQUNoQjs7QUFFQTtFQUNFLGtCQUFrQjtFQUNsQixhQUFhO0FBQ2Y7O0FBRUE7RUFDRSxXQUFXO0VBQ1gsbUJBQW1CO0FBQ3JCOztBQUVBO0VBQ0UsV0FBVztFQUNYLG1CQUFtQjtBQUNyQjs7QUFFQTtFQUNFLGFBQWE7RUFDYixTQUFTO0VBQ1QsdUJBQXVCO0VBQ3ZCLG1CQUFtQjtBQUNyQjs7QUFFQTtFQUNFLGtCQUFrQjtFQUNsQixpQkFBaUI7QUFDbkI7O0FBRUE7RUFDRSxhQUFhO0VBQ2IsdUJBQXVCO0VBQ3ZCLFNBQVM7RUFDVCxlQUFlO0VBQ2YsbUJBQW1CO0VBQ25CLGtCQUFrQjtBQUNwQjs7QUFFQTtFQUNFLGFBQWE7RUFDYixtQkFBbUI7RUFDbkIsV0FBVztFQUNYLFdBQVc7RUFDWCxnQkFBZ0I7QUFDbEI7O0FBRUE7RUFDRSxjQUFjO0FBQ2hCOztBQUVBO0VBQ0UsaUJBQWlCO0FBQ25COztBQUVBO0VBQ0UsY0FBYztBQUNoQjs7QUFFQTtFQUNFLDZEQUE2RDtFQUM3RCx5QkFBeUI7RUFDekIsa0JBQWtCO0VBQ2xCLGFBQWE7QUFDZjs7QUFFQTtFQUNFLGNBQWM7RUFDZCxtQkFBbUI7QUFDckI7O0FBRUE7RUFDRSxhQUFhO0VBQ2IsU0FBUztFQUNULHVCQUF1QjtFQUN2QixjQUFjO0FBQ2hCOztBQUVBO0VBQ0UsY0FBYztFQUNkLG1CQUFtQjtFQUNuQixvQkFBb0I7RUFDcEIsa0JBQWtCO0VBQ2xCLHFCQUFxQjtFQUNyQixnQkFBZ0I7QUFDbEI7O0FBRUE7RUFDRSxtQkFBbUI7RUFDbkIseUJBQXlCO0VBQ3pCLGtCQUFrQjtFQUNsQixhQUFhO0FBQ2Y7O0FBRUE7RUFDRSxjQUFjO0VBQ2QsbUJBQW1CO0FBQ3JCOztBQUVBO0VBQ0UsZUFBZTtFQUNmLE1BQU07RUFDTixPQUFPO0VBQ1AsUUFBUTtFQUNSLFNBQVM7RUFDVCwyQkFBMkI7RUFDM0IsYUFBYTtFQUNiLG1CQUFtQjtFQUNuQix1QkFBdUI7RUFDdkIsYUFBYTtBQUNmOztBQUVBO0VBQ0UsZ0JBQWdCO0VBQ2hCLFdBQVc7RUFDWCxxQkFBcUI7QUFDdkI7O0FBRUE7RUFDRSxrQkFBa0I7RUFDbEIsV0FBVztFQUNYLGtCQUFrQjtFQUNsQixrQkFBa0I7QUFDcEIiLCJzb3VyY2VzQ29udGVudCI6WyIuc2Vzc2lvbi1oZWFkZXIge1xuICBiYWNrZ3JvdW5kOiB3aGl0ZTtcbiAgYm9yZGVyLXJhZGl1czogMTJweDtcbiAgcGFkZGluZzogMnJlbTtcbiAgbWFyZ2luLWJvdHRvbTogMnJlbTtcbiAgYm94LXNoYWRvdzogMCA0cHggMjBweCByZ2JhKDAsMCwwLDAuMDgpO1xufVxuXG4uc2Vzc2lvbi1oZWFkZXIgaDEge1xuICBtYXJnaW46IDAgMCAxcmVtIDA7XG4gIGNvbG9yOiAjMzMzO1xufVxuXG4uc2Vzc2lvbi1tZXRhIHtcbiAgZGlzcGxheTogZmxleDtcbiAgZ2FwOiAxcmVtO1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBmbGV4LXdyYXA6IHdyYXA7XG59XG5cbi5yb2xlLWJhZGdlIHtcbiAgcGFkZGluZzogMC41cmVtIDFyZW07XG4gIGJvcmRlci1yYWRpdXM6IDIwcHg7XG4gIGZvbnQtd2VpZ2h0OiA1MDA7XG4gIGNvbG9yOiB3aGl0ZTtcbn1cblxuLnJvbGUtYSB7XG4gIGJhY2tncm91bmQ6ICMwMDdiZmY7XG59XG5cbi5yb2xlLWIge1xuICBiYWNrZ3JvdW5kOiAjMjhhNzQ1O1xufVxuXG4uc3RhdGUtYmFkZ2Uge1xuICBwYWRkaW5nOiAwLjVyZW0gMXJlbTtcbiAgYm9yZGVyLXJhZGl1czogMjBweDtcbiAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgYmFja2dyb3VuZDogI2Y4ZjlmYTtcbiAgY29sb3I6ICM2NjY7XG59XG5cbi5zdGF0ZS1jcmVhdGVkIHsgYmFja2dyb3VuZDogI2Y4ZjlmYTsgY29sb3I6ICM2NjY7IH1cbi5zdGF0ZS1yZWFkeSB7IGJhY2tncm91bmQ6ICNmZmYzY2Q7IGNvbG9yOiAjODU2NDA0OyB9XG4uc3RhdGUtYWNjZXB0ZWQgeyBiYWNrZ3JvdW5kOiAjZDFlY2YxOyBjb2xvcjogIzBjNTQ2MDsgfVxuLnN0YXRlLXJlbGVhc2VkIHsgYmFja2dyb3VuZDogI2Q0ZWRkYTsgY29sb3I6ICMxNTU3MjQ7IH1cbi5zdGF0ZS1jYW5jZWxsZWQgeyBiYWNrZ3JvdW5kOiAjZjhkN2RhOyBjb2xvcjogIzcyMWMyNDsgfVxuLnN0YXRlLWV4cGlyZWQgeyBiYWNrZ3JvdW5kOiAjZTBlMGUwOyBjb2xvcjogIzY2NjsgfVxuXG4udGltZXIge1xuICBwYWRkaW5nOiAwLjVyZW0gMXJlbTtcbiAgYmFja2dyb3VuZDogI2YwZjhmZjtcbiAgYm9yZGVyLXJhZGl1czogMjBweDtcbiAgY29sb3I6ICMwMDY2Y2M7XG4gIGZvbnQtd2VpZ2h0OiA1MDA7XG59XG5cbi5leGNoYW5nZS1ncmlkIHtcbiAgZGlzcGxheTogZ3JpZDtcbiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyO1xuICBnYXA6IDJyZW07XG4gIG1hcmdpbi1ib3R0b206IDJyZW07XG59XG5cbkBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkge1xuICAuZXhjaGFuZ2UtZ3JpZCB7XG4gICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnI7XG4gIH1cbn1cblxuLmZpbGUtc2VjdGlvbiAuY2FyZCB7XG4gIGhlaWdodDogMTAwJTtcbiAgbWluLWhlaWdodDogNDAwcHg7XG59XG5cbi5maWxlLXNlY3Rpb24gaDIge1xuICBjb2xvcjogIzMzMztcbiAgbWFyZ2luLWJvdHRvbTogMS41cmVtO1xuICBwYWRkaW5nLWJvdHRvbTogMXJlbTtcbiAgYm9yZGVyLWJvdHRvbTogMnB4IHNvbGlkICNmMGYwZjA7XG59XG5cbi53YWl0aW5nLXBlZXIge1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIHBhZGRpbmc6IDNyZW07XG4gIGNvbG9yOiAjOTk5O1xufVxuXG4ud2FpdGluZy1pY29uIHtcbiAgZm9udC1zaXplOiAzcmVtO1xuICBtYXJnaW4tYm90dG9tOiAxcmVtO1xuICBhbmltYXRpb246IHB1bHNlIDJzIGluZmluaXRlO1xufVxuXG5Aa2V5ZnJhbWVzIHB1bHNlIHtcbiAgMCUsIDEwMCUgeyBvcGFjaXR5OiAxOyB9XG4gIDUwJSB7IG9wYWNpdHk6IDAuNTsgfVxufVxuXG4udXBsb2FkLXByb2dyZXNzIHtcbiAgcGFkZGluZzogMXJlbTtcbn1cblxuLmZpbGUtaW5mbyB7XG4gIHBhZGRpbmc6IDFyZW07XG4gIGJhY2tncm91bmQ6ICNmOGY5ZmE7XG4gIGJvcmRlci1yYWRpdXM6IDhweDtcbn1cblxuLmZpbGUtaWNvbiB7XG4gIGZvbnQtc2l6ZTogM3JlbTtcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xuICBtYXJnaW4tYm90dG9tOiAxcmVtO1xufVxuXG4uZmlsZS1kZXRhaWxzIGgzIHtcbiAgY29sb3I6ICMzMzM7XG4gIG1hcmdpbi1ib3R0b206IDAuNXJlbTtcbiAgd29yZC1icmVhazogYnJlYWstYWxsO1xufVxuXG4uZmlsZS1kZXRhaWxzIHAge1xuICBjb2xvcjogIzY2NjtcbiAgbWFyZ2luLWJvdHRvbTogMC41cmVtO1xufVxuXG4uaGFzaC1pbmZvIHtcbiAgbWFyZ2luLXRvcDogMXJlbTtcbiAgcGFkZGluZzogMC41cmVtO1xuICBiYWNrZ3JvdW5kOiB3aGl0ZTtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xufVxuXG4uaGFzaC1pbmZvIGNvZGUge1xuICBmb250LWZhbWlseTogJ0NvdXJpZXIgTmV3JywgbW9ub3NwYWNlO1xuICBmb250LXNpemU6IDAuOHJlbTtcbiAgY29sb3I6ICM2NjY7XG4gIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDtcbn1cblxuLmZpbGUtcHJldmlldyB7XG4gIG1hcmdpbi10b3A6IDFyZW07XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbn1cblxuLmZpbGUtcHJldmlldyBpbWcge1xuICBtYXgtd2lkdGg6IDEwMCU7XG4gIG1heC1oZWlnaHQ6IDIwMHB4O1xuICBib3JkZXItcmFkaXVzOiA4cHg7XG4gIGJveC1zaGFkb3c6IDAgMnB4IDEwcHggcmdiYSgwLDAsMCwwLjEpO1xufVxuXG4uYWNjZXB0ZWQtYmFkZ2Uge1xuICBjb2xvcjogIzI4YTc0NTtcbiAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgbWFyZ2luLXRvcDogMC41cmVtO1xufVxuXG4uc3RhdHVzLXJlYWR5IHsgY29sb3I6ICMyOGE3NDU7IH1cbi5zdGF0dXMtcHJvY2Vzc2luZyB7IGNvbG9yOiAjZmZjMTA3OyB9XG4uc3RhdHVzLXVwbG9hZGluZyB7IGNvbG9yOiAjMTdhMmI4OyB9XG4uc3RhdHVzLXNjYW5uaW5nIHsgY29sb3I6ICM2Yzc1N2Q7IH1cbi5zdGF0dXMtYmxvY2tlZCB7IGNvbG9yOiAjZGMzNTQ1OyB9XG5cbi5hY3Rpb24tc2VjdGlvbiB7XG4gIG1hcmdpbjogMnJlbSAwO1xufVxuXG4uYWN0aW9uLXNlY3Rpb24gLmNhcmQge1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIHBhZGRpbmc6IDJyZW07XG59XG5cbi5hY3Rpb24tc2VjdGlvbiBoMiB7XG4gIGNvbG9yOiAjMzMzO1xuICBtYXJnaW4tYm90dG9tOiAxcmVtO1xufVxuXG4uYWN0aW9uLXNlY3Rpb24gcCB7XG4gIGNvbG9yOiAjNjY2O1xuICBtYXJnaW4tYm90dG9tOiAycmVtO1xufVxuXG4uYWN0aW9uLWJ1dHRvbnMge1xuICBkaXNwbGF5OiBmbGV4O1xuICBnYXA6IDFyZW07XG4gIGp1c3RpZnktY29udGVudDogY2VudGVyO1xuICBtYXJnaW4tYm90dG9tOiAycmVtO1xufVxuXG4uYnRuLWxhcmdlIHtcbiAgcGFkZGluZzogMXJlbSAycmVtO1xuICBmb250LXNpemU6IDEuMXJlbTtcbn1cblxuLnZhbGlkYXRpb24tc3RhdHVzIHtcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gIGdhcDogM3JlbTtcbiAgcGFkZGluZzogMS41cmVtO1xuICBiYWNrZ3JvdW5kOiAjZjhmOWZhO1xuICBib3JkZXItcmFkaXVzOiA4cHg7XG59XG5cbi52YWxpZGF0aW9uLWl0ZW0ge1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBnYXA6IDAuNXJlbTtcbiAgY29sb3I6ICM2NjY7XG4gIGZvbnQtd2VpZ2h0OiA1MDA7XG59XG5cbi52YWxpZGF0aW9uLWl0ZW0udmFsaWRhdGVkIHtcbiAgY29sb3I6ICMyOGE3NDU7XG59XG5cbi52YWxpZGF0aW9uLWljb24ge1xuICBmb250LXNpemU6IDEuNXJlbTtcbn1cblxuLmRvd25sb2FkLXNlY3Rpb24ge1xuICBtYXJnaW46IDJyZW0gMDtcbn1cblxuLnN1Y2Nlc3MtY2FyZCB7XG4gIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICNkNGVkZGEgMCUsICNjM2U2Y2IgMTAwJSk7XG4gIGJvcmRlcjogMnB4IHNvbGlkICNiMWRmYmI7XG4gIHRleHQtYWxpZ246IGNlbnRlcjtcbiAgcGFkZGluZzogMnJlbTtcbn1cblxuLnN1Y2Nlc3MtY2FyZCBoMiB7XG4gIGNvbG9yOiAjMTU1NzI0O1xuICBtYXJnaW4tYm90dG9tOiAxcmVtO1xufVxuXG4uZG93bmxvYWQtYnV0dG9ucyB7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGdhcDogMXJlbTtcbiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gIG1hcmdpbjogMnJlbSAwO1xufVxuXG4uZG93bmxvYWQtd2FybmluZyB7XG4gIGNvbG9yOiAjODU2NDA0O1xuICBiYWNrZ3JvdW5kOiAjZmZmM2NkO1xuICBwYWRkaW5nOiAwLjVyZW0gMXJlbTtcbiAgYm9yZGVyLXJhZGl1czogNHB4O1xuICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gIG1hcmdpbi10b3A6IDFyZW07XG59XG5cbi5lcnJvci1jYXJkIHtcbiAgYmFja2dyb3VuZDogI2Y4ZDdkYTtcbiAgYm9yZGVyOiAycHggc29saWQgI2Y1YzZjYjtcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xuICBwYWRkaW5nOiAycmVtO1xufVxuXG4uZXJyb3ItY2FyZCBoMiB7XG4gIGNvbG9yOiAjNzIxYzI0O1xuICBtYXJnaW4tYm90dG9tOiAxcmVtO1xufVxuXG4ubG9hZGluZy1vdmVybGF5IHtcbiAgcG9zaXRpb246IGZpeGVkO1xuICB0b3A6IDA7XG4gIGxlZnQ6IDA7XG4gIHJpZ2h0OiAwO1xuICBib3R0b206IDA7XG4gIGJhY2tncm91bmQ6IHJnYmEoMCwwLDAsMC41KTtcbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gIHotaW5kZXg6IDk5OTk7XG59XG5cbi5wcmV2aWV3LWxhYmVsIHtcbiAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgY29sb3I6ICM2NjY7XG4gIG1hcmdpbi1ib3R0b206IDAuNXJlbTtcbn1cblxuLnByZXZpZXctbm90ZSB7XG4gIGZvbnQtc2l6ZTogMC44NXJlbTtcbiAgY29sb3I6ICM5OTk7XG4gIGZvbnQtc3R5bGU6IGl0YWxpYztcbiAgbWFyZ2luLXRvcDogMC41cmVtO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["i0","ExchangeComponent","constructor","route","exchangeService","wsService","ngOnInit","queryParams","subscribe","params","sessionId","token","joinSession","errorMessage","subscriptions","push","messages$","message","handleWebSocketMessage","ngOnDestroy","forEach","sub","unsubscribe","disconnect","isLoading","response","jwtToken","localStorage","setItem","role","sessionState","state","expiresAt","Date","connect","refreshStatus","successMessage","error","status","getSessionStatus","session","myFile","me","file","peerFile","peer","iAccepted","accepted","peerAccepted","console","onFileSelect","event","target","files","handleFile","onDragOver","preventDefault","isDragging","onDragLeave","onDrop","dataTransfer","length","maxSize","size","selectedFile","uploadFile","isUploading","uploadProgress","presignResponse","getPresignedUrl","name","type","uploadToS3","uploadUrl","completeUpload","fileId","storageKey","id","filename","statusMessage","presignedUrl","Promise","resolve","reject","xhr","XMLHttpRequest","upload","addEventListener","e","lengthComputable","Math","round","loaded","total","Error","open","setRequestHeader","send","acceptExchange","canAccept","downloadUrls","rejectExchange","confirm","downloadFile","url","fullUrl","startsWith","window","log","reason","formatFileSize","bytes","k","sizes","i","floor","pow","getTimeRemaining","now","getTime","expires","diff","hours","minutes","getStatusClass","getStatusText","getPreviewUrl","onPreviewError","style","display","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["C:\\Users\\jmdall\\PhpstormProjects\\secure-file-exchange\\frontend\\src\\app\\components\\exchange\\exchange.component.html","C:\\Users\\jmdall\\PhpstormProjects\\secure-file-exchange\\frontend\\src\\app\\components\\exchange\\exchange.component.ts"],"sourcesContent":["<div class=\"container\">\n  <!-- Header with session info -->\n  <div class=\"session-header\">\n    <h1>🔒 Session d'échange</h1>\n    <div class=\"session-meta\">\n      <span class=\"role-badge\" [class.role-a]=\"role === 'A'\" [class.role-b]=\"role === 'B'\">\n        Participant {{role}}\n      </span>\n      <span class=\"state-badge\" [class]=\"'state-' + sessionState\">\n        {{sessionState}}\n      </span>\n      <span class=\"timer\" *ngIf=\"expiresAt\">\n        ⏱️ {{getTimeRemaining()}}\n      </span>\n    </div>\n  </div>\n\n  <!-- Messages -->\n  <div class=\"alert alert-success\" *ngIf=\"successMessage\">\n    {{successMessage}}\n  </div>\n  \n  <div class=\"alert alert-info\" *ngIf=\"statusMessage\">\n    {{statusMessage}}\n  </div>\n  \n  <div class=\"alert alert-danger\" *ngIf=\"errorMessage\">\n    {{errorMessage}}\n  </div>\n\n  <!-- Loading spinner -->\n  <div class=\"loading-overlay\" *ngIf=\"isLoading\">\n    <div class=\"spinner\"></div>\n  </div>\n\n  <!-- Main content grid -->\n  <div class=\"exchange-grid\">\n    <!-- My file section -->\n    <div class=\"file-section\">\n      <div class=\"card\">\n        <h2>📁 Mon fichier</h2>\n        \n        <!-- Upload zone -->\n        <div *ngIf=\"!myFile\" \n             class=\"file-upload\"\n             [class.dragging]=\"isDragging\"\n             (click)=\"fileInput.click()\"\n             (dragover)=\"onDragOver($event)\"\n             (dragleave)=\"onDragLeave($event)\"\n             (drop)=\"onDrop($event)\">\n          <div class=\"upload-icon\">⬆️</div>\n          <p>Cliquez ou glissez votre fichier ici</p>\n          <p class=\"upload-hint\">Max 2 GB • Tous formats acceptés</p>\n          <input #fileInput \n                 type=\"file\" \n                 style=\"display: none\"\n                 (change)=\"onFileSelect($event)\">\n        </div>\n        \n        <!-- Upload progress -->\n        <div *ngIf=\"isUploading\" class=\"upload-progress\">\n          <div class=\"progress-bar\">\n            <div class=\"progress-fill\" [style.width.%]=\"uploadProgress\"></div>\n          </div>\n          <p class=\"text-center\">Upload: {{uploadProgress}}%</p>\n        </div>\n        \n        <!-- File info -->\n        <div *ngIf=\"myFile\" class=\"file-info\">\n          <div class=\"file-icon\">📄</div>\n          <div class=\"file-details\">\n            <h3>{{myFile.filename}}</h3>\n            <p>Taille: {{formatFileSize(myFile.size)}}</p>\n            <p>\n              Statut: \n              <span [class]=\"getStatusClass(myFile.status)\">\n                {{getStatusText(myFile.status)}}\n              </span>\n            </p>\n            <p *ngIf=\"iAccepted\" class=\"accepted-badge\">\n              ✅ Vous avez accepté l'échange\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- Peer file section -->\n    <div class=\"file-section\">\n      <div class=\"card\">\n        <h2>🔍 Fichier de l'autre participant</h2>\n        \n        <!-- Waiting state -->\n        <div *ngIf=\"!peerFile\" class=\"waiting-peer\">\n          <div class=\"waiting-icon\">⏳</div>\n          <p>En attente du fichier...</p>\n        </div>\n        \n        <!-- Peer file info -->\n        <div *ngIf=\"peerFile\" class=\"file-info\">\n          <div class=\"file-icon\">📄</div>\n          <div class=\"file-details\">\n            <h3>{{peerFile.filename}}</h3>\n            <p>Taille: {{formatFileSize(peerFile.size)}}</p>\n            <p>Type: {{peerFile.mimeType}}</p>\n            <p>\n              Statut: \n              <span [class]=\"getStatusClass(peerFile.status)\">\n                {{getStatusText(peerFile.status)}}\n              </span>\n            </p>\n            <div *ngIf=\"peerFile.sha256\" class=\"hash-info\">\n              <p>SHA-256:</p>\n              <code>{{peerFile.sha256?.substring(0, 32)}}...</code>\n            </div>\n            <p *ngIf=\"peerAccepted\" class=\"accepted-badge\">\n              ✅ L'autre participant a accepté\n            </p>\n          </div>\n          \n          <!-- Preview if available -->\n          <div *ngIf=\"peerFile.previewUrl && peerFile.status === 'ready'\" class=\"file-preview\">\n            <p class=\"preview-label\">Aperçu :</p>\n            <img [src]=\"getPreviewUrl(peerFile.previewUrl)\" \n                 alt=\"Aperçu du fichier\"\n                 (error)=\"onPreviewError($event)\">\n            <p class=\"preview-note\">Aperçu limité - Le fichier complet sera disponible après validation</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Action buttons -->\n  <div class=\"action-section\" *ngIf=\"sessionState === 'ready'\">\n    <div class=\"card\">\n      <h2>Validation de l'échange</h2>\n      <p>Les deux fichiers sont prêts. Vérifiez les informations ci-dessus avant d'accepter.</p>\n      \n      <div class=\"action-buttons\">\n        <button class=\"btn btn-primary btn-large\" \n                (click)=\"acceptExchange()\" \n                [disabled]=\"!canAccept() || iAccepted || isLoading\">\n          <span *ngIf=\"!iAccepted\">✅ Accepter l'échange</span>\n          <span *ngIf=\"iAccepted\">✓ Accepté</span>\n        </button>\n        \n        <button class=\"btn btn-danger\" \n                (click)=\"rejectExchange()\"\n                [disabled]=\"iAccepted || isLoading\">\n          ❌ Refuser l'échange\n        </button>\n      </div>\n      \n      <div class=\"validation-status\">\n        <div class=\"validation-item\" [class.validated]=\"iAccepted\">\n          <span class=\"validation-icon\">{{iAccepted ? '✅' : '⭕'}}</span>\n          <span>Votre validation</span>\n        </div>\n        <div class=\"validation-item\" [class.validated]=\"peerAccepted\">\n          <span class=\"validation-icon\">{{peerAccepted ? '✅' : '⭕'}}</span>\n          <span>Validation de l'autre participant</span>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- Download section -->\n  <div class=\"download-section\" *ngIf=\"sessionState === 'released' && downloadUrls\">\n    <div class=\"card success-card\">\n      <h2>🎉 Échange validé avec succès !</h2>\n      <p>Les deux parties ont accepté l'échange. Vous pouvez maintenant télécharger les fichiers.</p>\n      \n      <div class=\"download-buttons\">\n        <button class=\"btn btn-success btn-large\" (click)=\"downloadFile('mine')\">\n          ⬇️ Télécharger mon fichier\n        </button>\n        <button class=\"btn btn-success btn-large\" (click)=\"downloadFile('peer')\">\n          ⬇️ Télécharger le fichier reçu\n        </button>\n      </div>\n      \n      <p class=\"download-warning\">\n        ⚠️ Les liens de téléchargement expirent dans 10 minutes\n      </p>\n    </div>\n  </div>\n\n  <!-- Cancelled state -->\n  <div *ngIf=\"sessionState === 'cancelled'\" class=\"card error-card\">\n    <h2>❌ Échange annulé</h2>\n    <p>L'échange a été annulé. Les fichiers ont été supprimés.</p>\n  </div>\n\n  <!-- Expired state -->\n  <div *ngIf=\"sessionState === 'expired'\" class=\"card error-card\">\n    <h2>⏱️ Session expirée</h2>\n    <p>La session a expiré. Les fichiers ont été supprimés.</p>\n  </div>\n</div>\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { ExchangeService } from '../../services/exchange.service';\nimport { WebSocketService } from '../../services/websocket.service';\nimport { Subscription } from 'rxjs';\n\n@Component({\n  selector: 'app-exchange',\n  templateUrl: './exchange.component.html',\n  styleUrls: ['./exchange.component.css']\n})\nexport class ExchangeComponent implements OnInit, OnDestroy {\n  // Session info\n  sessionId: string = '';\n  token: string = '';\n  jwtToken: string = '';\n  role: 'A' | 'B' = 'A';\n  sessionState: string = 'created';\n  expiresAt: Date | null = null;\n  \n  // Files\n  myFile: any = null;\n  peerFile: any = null;\n  selectedFile: File | null = null;\n  uploadProgress: number = 0;\n  isUploading: boolean = false;\n  \n  // Acceptance states\n  iAccepted: boolean = false;\n  peerAccepted: boolean = false;\n  \n  // Download URLs\n  downloadUrls: any = null;\n  \n  // Subscriptions\n  private subscriptions: Subscription[] = [];\n  \n  // Messages\n  statusMessage: string = '';\n  errorMessage: string = '';\n  successMessage: string = '';\n  \n  // UI states\n  isLoading: boolean = false;\n  isDragging: boolean = false;\n  \n  constructor(\n    private route: ActivatedRoute,\n    private exchangeService: ExchangeService,\n    private wsService: WebSocketService\n  ) {}\n  \n  ngOnInit() {\n    // Get parameters from URL\n    this.route.queryParams.subscribe(params => {\n      this.sessionId = params['sid'];\n      this.token = params['token'];\n      \n      if (this.sessionId && this.token) {\n        this.joinSession();\n      } else {\n        this.errorMessage = 'Paramètres de session manquants';\n      }\n    });\n    \n    // Listen to WebSocket messages\n    this.subscriptions.push(\n      this.wsService.messages$.subscribe(message => {\n        this.handleWebSocketMessage(message);\n      })\n    );\n  }\n  \n  ngOnDestroy() {\n    this.subscriptions.forEach(sub => sub.unsubscribe());\n    this.wsService.disconnect();\n  }\n  \n  async joinSession() {\n    this.isLoading = true;\n    this.errorMessage = '';\n    \n    try {\n      const response = await this.exchangeService.joinSession(this.sessionId, this.token);\n      \n      // Store JWT token\n      this.jwtToken = response.token;\n      localStorage.setItem('exchangeToken', response.token);\n      this.role = response.role;\n      this.sessionState = response.state;\n      this.expiresAt = new Date(response.expiresAt);\n      \n      // Connect to WebSocket\n      this.wsService.connect(response.token);\n      \n      // Get initial status\n      await this.refreshStatus();\n      \n      this.successMessage = `Connecté en tant que participant ${this.role}`;\n    } catch (error: any) {\n      this.errorMessage = error.error?.message || 'Erreur lors de la connexion';\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  \n  async refreshStatus() {\n    try {\n      const status = await this.exchangeService.getSessionStatus(this.sessionId);\n      \n      this.sessionState = status.session.state;\n      this.myFile = status.me.file;\n      this.peerFile = status.peer.file;\n      this.iAccepted = status.me.accepted;\n      this.peerAccepted = status.peer.accepted;\n      \n    } catch (error: any) {\n      console.error('Error refreshing status:', error);\n    }\n  }\n  \n  onFileSelect(event: any) {\n    const file = event.target.files[0];\n    if (file) {\n      this.handleFile(file);\n    }\n  }\n  \n  onDragOver(event: DragEvent) {\n    event.preventDefault();\n    this.isDragging = true;\n  }\n  \n  onDragLeave(event: DragEvent) {\n    event.preventDefault();\n    this.isDragging = false;\n  }\n  \n  onDrop(event: DragEvent) {\n    event.preventDefault();\n    this.isDragging = false;\n    \n    const files = event.dataTransfer?.files;\n    if (files && files.length > 0) {\n      this.handleFile(files[0]);\n    }\n  }\n  \n  handleFile(file: File) {\n    // Check file size\n    const maxSize = 2 * 1024 * 1024 * 1024; // 2GB\n    if (file.size > maxSize) {\n      this.errorMessage = 'Fichier trop volumineux (max 2GB)';\n      return;\n    }\n    \n    this.selectedFile = file;\n    this.uploadFile();\n  }\n  \n  async uploadFile() {\n    if (!this.selectedFile) return;\n    \n    this.isUploading = true;\n    this.uploadProgress = 0;\n    this.errorMessage = '';\n    \n    try {\n      // Get presigned URL\n      const presignResponse = await this.exchangeService.getPresignedUrl(\n        this.selectedFile.name,\n        this.selectedFile.size,\n        this.selectedFile.type || 'application/octet-stream'\n      );\n      \n      // Upload to S3\n      await this.uploadToS3(this.selectedFile, presignResponse.uploadUrl);\n      \n      // Confirm upload completion\n      await this.exchangeService.completeUpload(\n        presignResponse.fileId,\n        presignResponse.storageKey\n      );\n      \n      this.myFile = {\n        id: presignResponse.fileId,\n        filename: this.selectedFile.name,\n        size: this.selectedFile.size,\n        status: 'processing'\n      };\n      \n      this.statusMessage = 'Fichier en cours de traitement...';\n      this.selectedFile = null;\n      \n    } catch (error: any) {\n      this.errorMessage = error.error?.message || 'Erreur lors de l\\'upload';\n    } finally {\n      this.isUploading = false;\n      this.uploadProgress = 0;\n    }\n  }\n  \n  private uploadToS3(file: File, presignedUrl: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      \n      xhr.upload.addEventListener('progress', (e) => {\n        if (e.lengthComputable) {\n          this.uploadProgress = Math.round((e.loaded / e.total) * 100);\n        }\n      });\n      \n      xhr.addEventListener('load', () => {\n        if (xhr.status >= 200 && xhr.status < 300) {\n          resolve();\n        } else {\n          reject(new Error(`Upload failed: ${xhr.status}`));\n        }\n      });\n      \n      xhr.addEventListener('error', () => {\n        reject(new Error('Upload failed'));\n      });\n      \n      xhr.open('PUT', presignedUrl);\n      xhr.setRequestHeader('Content-Type', file.type || 'application/octet-stream');\n      xhr.send(file);\n    });\n  }\n  \n  async acceptExchange() {\n    if (!this.canAccept()) return;\n    \n    this.isLoading = true;\n    this.errorMessage = '';\n    \n    try {\n      const response = await this.exchangeService.acceptExchange(this.sessionId);\n      this.iAccepted = true;\n      \n      if (response.state === 'released') {\n        this.sessionState = 'released';\n        this.downloadUrls = response.downloadUrls;\n        this.successMessage = 'Échange validé ! Les fichiers sont disponibles.';\n      } else {\n        this.statusMessage = 'En attente de l\\'acceptation de l\\'autre participant...';\n      }\n    } catch (error: any) {\n      this.errorMessage = error.error?.message || 'Erreur lors de l\\'acceptation';\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  \n  async rejectExchange() {\n    if (confirm('Êtes-vous sûr de vouloir annuler cet échange ?')) {\n      this.isLoading = true;\n      try {\n        await this.exchangeService.rejectExchange(this.sessionId);\n        this.sessionState = 'cancelled';\n        this.statusMessage = 'Échange annulé';\n      } catch (error: any) {\n        this.errorMessage = error.error?.message || 'Erreur lors de l\\'annulation';\n      } finally {\n        this.isLoading = false;\n      }\n    }\n  }\n  \n  canAccept(): boolean {\n    return this.sessionState === 'ready' && \n           !this.iAccepted && \n           this.myFile?.status === 'ready' && \n           this.peerFile?.status === 'ready';\n  }\n  \n  downloadFile(type: 'mine' | 'peer') {\n    if (!this.downloadUrls) return;\n    \n    const url = type === 'mine' ? \n      this.downloadUrls[this.role] : \n      this.downloadUrls[this.role === 'A' ? 'B' : 'A'];\n    \n    // Add base URL if needed\n    const fullUrl = url.startsWith('http') ? url : `http://localhost:3000${url}`;\n    window.open(fullUrl, '_blank');\n  }\n  \n  private handleWebSocketMessage(message: any) {\n    switch (message.type) {\n      case 'connected':\n        console.log('WebSocket connected');\n        break;\n        \n      case 'file_ready':\n        this.refreshStatus();\n        this.statusMessage = 'Un fichier est prêt';\n        break;\n        \n      case 'session_ready':\n        this.sessionState = 'ready';\n        this.successMessage = 'Les deux fichiers sont prêts. Vous pouvez maintenant accepter l\\'échange.';\n        this.refreshStatus();\n        break;\n        \n      case 'peer_accepted':\n        this.peerAccepted = true;\n        this.statusMessage = 'L\\'autre participant a accepté l\\'échange';\n        break;\n        \n      case 'released':\n        this.sessionState = 'released';\n        this.downloadUrls = message.downloadUrls;\n        this.successMessage = 'Échange validé ! Les fichiers sont disponibles.';\n        break;\n        \n      case 'cancelled':\n        this.sessionState = 'cancelled';\n        this.statusMessage = 'L\\'échange a été annulé';\n        break;\n        \n      case 'file_blocked':\n        this.errorMessage = `Fichier bloqué : ${message.reason}`;\n        break;\n        \n      case 'error':\n        this.errorMessage = message.message;\n        break;\n    }\n  }\n  \n  formatFileSize(bytes: number): string {\n    if (!bytes) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n  }\n  \n  getTimeRemaining(): string {\n    if (!this.expiresAt) return '';\n    \n    const now = new Date().getTime();\n    const expires = this.expiresAt.getTime();\n    const diff = expires - now;\n    \n    if (diff <= 0) return 'Expiré';\n    \n    const hours = Math.floor(diff / (1000 * 60 * 60));\n    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n    \n    return `${hours}h ${minutes}min`;\n  }\n  \n  getStatusClass(status: string): string {\n    switch (status) {\n      case 'ready': return 'status-ready';\n      case 'processing': return 'status-processing';\n      case 'uploading': return 'status-uploading';\n      case 'scanning': return 'status-scanning';\n      case 'blocked': return 'status-blocked';\n      default: return '';\n    }\n  }\n  \n  getStatusText(status: string): string {\n    switch (status) {\n      case 'ready': return 'Prêt';\n      case 'processing': return 'Traitement...';\n      case 'uploading': return 'Upload...';\n      case 'scanning': return 'Scan antivirus...';\n      case 'blocked': return 'Bloqué';\n      default: return status;\n    }\n  }\n  \n  getPreviewUrl(url: string): string {\n    // Construire l'URL complète pour la preview\n    if (url.startsWith('http')) {\n      return url;\n    }\n    return `http://localhost:3000${url}`;\n  }\n  \n  onPreviewError(event: any) {\n    console.log('Preview failed to load');\n    // Masquer l'image en erreur\n    event.target.style.display = 'none';\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}